{
  "openapi": "3.0.1",
  "info": {
    "title": "activity-log",
    "version": "2019-03-08T07:40:22Z"
  },
  "servers": [
    {
      "url": "https://c4mpyiczgd.execute-api.eu-central-1.amazonaws.com/{basePath}",
      "variables": {
        "basePath": {
          "default": "/dev"
        }
      }
    }
  ],
  "paths": {
    "/duties": {
      "get": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-integration": {
          "uri": "arn:aws:apigateway:eu-central-1:lambda:path/2015-03-31/functions/arn:aws:lambda:eu-central-1:953201351151:function:sebcel-activitylog-GetDuties-${stageVariables.stageName}/invocations",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "POST",
          "contentHandling": "CONVERT_TO_TEXT",
          "type": "aws_proxy"
        }
      },
      "post": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-integration": {
          "uri": "arn:aws:apigateway:eu-central-1:lambda:path/2015-03-31/functions/arn:aws:lambda:eu-central-1:953201351151:function:sebcel-activitylog-SaveDutyData-${stageVariables.stageName}/invocations",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "POST",
          "contentHandling": "CONVERT_TO_TEXT",
          "type": "aws_proxy"
        }
      },
      "delete": {
        "parameters": [
          {
            "name": "dutyType",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "user",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-request-validator": "Validate query string parameters and headers",
        "x-amazon-apigateway-integration": {
          "uri": "arn:aws:apigateway:eu-central-1:lambda:path/2015-03-31/functions/arn:aws:lambda:eu-central-1:953201351151:function:sebcel-activitylog-DeleteDutyData-${stageVariables.stageName}/invocations",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "httpMethod": "POST",
          "contentHandling": "CONVERT_TO_TEXT",
          "type": "aws_proxy"
        }
      },
      "options": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Methods": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Headers": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'DELETE,POST,GET,OPTIONS'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "requestTemplates": {
            "application/json": "{\"statusCode\": 200}"
          },
          "type": "mock"
        }
      }
    },
    "/activities": {
      "get": {
        "description": "Returns all activities",
        "parameters": [
          {
            "name": "user",
            "in": "query",
            "description": "Name of a user",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of activities for given user",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-request-validator": "Validate query string parameters and headers",
        "x-amazon-apigateway-integration": {
          "credentials": "arn:aws:iam::953201351151:role/sebcel-activitylog-dynamodb-${stageVariables.stageName}",
          "uri": "arn:aws:apigateway:eu-central-1:dynamodb:path//",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              },
              "responseTemplates": {
                "application/json": "#set($inputRoot = $input.path('$'))\n[#foreach($elem in $inputRoot.Items)\n{\n  \"id\" : \"$elem.id.S\",\n  \"date\" : \"$elem.date.S\",\n  \"user\" : \"$elem.user.S\",\n  \"type\" : \"$elem.type.S\",\n  \"description\" : \"$elem.description.S\",\n  \"duration\" : $elem.duration.N\n}\n#if($foreach.hasNext),#end\n#end\n]"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.X-Amz-Target": "'DynamoDB_20120810.Scan'",
            "integration.request.header.Content-Type": "'application/x-amz-json-1.0'"
          },
          "passthroughBehavior": "when_no_templates",
          "httpMethod": "POST",
          "requestTemplates": {
            "application/json": "{\n    \"TableName\": \"activity-log-${stageVariables.stageName}\",\n    \"FilterExpression\": \"#c = :val\",\n    \"ExpressionAttributeValues\": {\":val\": {\"S\": \"$input.params('user')\"}},\n    \"ExpressionAttributeNames\": {\"#c\": \"user\"}\n}"
          },
          "type": "aws"
        }
      },
      "post": {
        "description": "Adds a new activity",
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-integration": {
          "credentials": "arn:aws:iam::953201351151:role/sebcel-activitylog-dynamodb-${stageVariables.stageName}",
          "uri": "arn:aws:apigateway:eu-central-1:dynamodb:path//",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.header.X-Amz-Target": "'DynamoDB_20111205.PutItem'",
            "integration.request.header.Content-Type": "'application/x-amz-json-1.0'"
          },
          "passthroughBehavior": "when_no_templates",
          "httpMethod": "POST",
          "requestTemplates": {
            "application/json": "#set($inputRoot = $input.path('$'))\n{\n    \"TableName\": \"activity-log-${stageVariables.stageName}\",\n    \"Item\": {\n        \"id\": { \"S\": \"${inputRoot.id}\" },\n      \t\"date\": { \"S\": \"${inputRoot.date}\" },\n       \t\"type\": { \"S\": \"${inputRoot.type}\" },\n       \t\"user\": { \"S\": \"${inputRoot.user}\" },\n       \t\"description\": { \"S\": \"${inputRoot.description}\" },\n       \t\"duration\": { \"N\": \"${inputRoot.duration}\"}\n    }\n}"
          },
          "type": "aws"
        }
      },
      "options": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Methods": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Headers": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'POST,GET,OPTIONS'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "requestTemplates": {
            "application/json": "{\"statusCode\": 200}"
          },
          "type": "mock"
        }
      }
    },
    "/dutytypes": {
      "get": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-integration": {
          "uri": "arn:aws:apigateway:eu-central-1:lambda:path/2015-03-31/functions/arn:aws:lambda:eu-central-1:953201351151:function:sebcel-activitylog-GetDutyTypes-${stageVariables.stageName}/invocations",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              },
              "responseTemplates": {
                "application/json": "#set($inputRoot = $input.path('$'))\n[#foreach($elem in $inputRoot.Items)\n\"$elem.type.S\"\n#if($foreach.hasNext),#end\n#end\n]"
              }
            }
          },
          "passthroughBehavior": "when_no_templates",
          "httpMethod": "POST",
          "contentHandling": "CONVERT_TO_TEXT",
          "type": "aws"
        }
      },
      "options": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Methods": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Headers": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'GET,OPTIONS'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "requestTemplates": {
            "application/json": "{\"statusCode\": 200}"
          },
          "type": "mock"
        }
      }
    },
    "/activities/{id}": {
      "delete": {
        "description": "Deletes an activity",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "security": [
          {
            "activity-log-cognito-authorizer": []
          },
          {
            "api_key": []
          }
        ],
        "x-amazon-apigateway-integration": {
          "credentials": "arn:aws:iam::953201351151:role/sebcel-activitylog-dynamodb-${stageVariables.stageName}",
          "uri": "arn:aws:apigateway:eu-central-1:dynamodb:path//",
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "requestParameters": {
            "integration.request.path.id": "method.request.path.id",
            "integration.request.header.X-Amz-Target": "'DynamoDB_20120810.DeleteItem'",
            "integration.request.header.Content-Type": "'application/x-amz-json-1.0'"
          },
          "passthroughBehavior": "when_no_templates",
          "httpMethod": "POST",
          "requestTemplates": {
            "application/json": "{\r\n    \"TableName\": \"activity-log-${stageVariables.stageName}\",\r\n    \"Key\": {\r\n        \"id\": {\r\n            \"S\": \"${method.request.path.id}\"\r\n        }\r\n    }\r\n}"
          },
          "type": "aws"
        }
      },
      "options": {
        "responses": {
          "200": {
            "description": "Valid response",
            "headers": {
              "Access-Control-Allow-Origin": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Methods": {
                "schema": {
                  "type": "string"
                }
              },
              "Access-Control-Allow-Headers": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Empty"
                }
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "responses": {
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Methods": "'DELETE,OPTIONS'",
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          },
          "passthroughBehavior": "when_no_match",
          "requestTemplates": {
            "application/json": "{\"statusCode\": 200}"
          },
          "type": "mock"
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Empty": {
        "title": "Empty Schema",
        "type": "object"
      }
    },
    "securitySchemes": {
      "api_key": {
        "type": "apiKey",
        "name": "x-api-key",
        "in": "header"
      },
      "activity-log-cognito-authorizer": {
        "type": "apiKey",
        "description": "Authorizer for ActivityLog application. Uses Cognito user pool.",
        "name": "Authorization",
        "in": "header",
        "x-amazon-apigateway-authtype": "cognito_user_pools",
        "x-amazon-apigateway-authorizer": {
          "providerARNs": [
            "arn:aws:cognito-idp:eu-central-1:953201351151:userpool/eu-central-1_Ux6VZ8Qoc"
          ],
          "type": "cognito_user_pools"
        }
      }
    }
  },
  "x-amazon-apigateway-documentation": {
    "version": "w",
    "createdDate": "2019-02-26T07:27:07Z",
    "documentationParts": [
      {
        "location": {
          "type": "API"
        },
        "properties": {
          "description": "API for ActivitiesLog application. Allows to get and save information about activities and duties."
        }
      },
      {
        "location": {
          "type": "AUTHORIZER",
          "name": "activity-log-cognito-authorizer"
        },
        "properties": {
          "description": "Authorizer for ActivityLog application. Uses Cognito user pool."
        }
      },
      {
        "location": {
          "type": "METHOD",
          "path": "/activities/{id}",
          "method": "DELETE"
        },
        "properties": {
          "description": "Deletes an activity"
        }
      },
      {
        "location": {
          "type": "METHOD",
          "path": "/activities",
          "method": "GET"
        },
        "properties": {
          "description": "Returns all activities"
        }
      },
      {
        "location": {
          "type": "METHOD",
          "path": "/activities",
          "method": "POST"
        },
        "properties": {
          "description": "Adds a new activity"
        }
      },
      {
        "location": {
          "type": "MODEL",
          "name": "Activity"
        },
        "properties": {
          "description": "Represents a single activity"
        }
      },
      {
        "location": {
          "type": "QUERY_PARAMETER",
          "path": "/activities",
          "method": "GET",
          "name": "user"
        },
        "properties": {
          "description": "Name of a user"
        }
      },
      {
        "location": {
          "type": "REQUEST_BODY",
          "path": "/activities",
          "method": "GET"
        },
        "properties": {
          "description": "This is request body documentation. What is it?"
        }
      },
      {
        "location": {
          "type": "RESOURCE",
          "path": "/activities"
        },
        "properties": {
          "description": "Allows to read and save activities"
        }
      },
      {
        "location": {
          "type": "RESOURCE",
          "path": "/duties"
        },
        "properties": {
          "description": "Allows to read and save duties"
        }
      },
      {
        "location": {
          "type": "RESOURCE",
          "path": "/dutytypes"
        },
        "properties": {
          "description": "Allows to get a list of duty types"
        }
      },
      {
        "location": {
          "type": "RESPONSE",
          "method": "*",
          "statusCode": "*"
        },
        "properties": {
          "description": "Generic description of a response"
        }
      },
      {
        "location": {
          "type": "RESPONSE",
          "method": "*",
          "statusCode": "200"
        },
        "properties": {
          "description": "Valid response"
        }
      },
      {
        "location": {
          "type": "RESPONSE",
          "path": "/activities",
          "method": "GET",
          "statusCode": "200"
        },
        "properties": {
          "description": "List of activities for given user"
        }
      }
    ]
  },
  "x-amazon-apigateway-policy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Principal": "*",
        "Action": "execute-api:Invoke",
        "Resource": "arn:aws:execute-api:eu-central-1:953201351151:c4mpyiczgd/*/*/*",
        "Condition": {
          "IpAddress": {
            "aws:SourceIp": [
              "77.67.107.102",
              "77.67.107.102"
            ]
          }
        }
      }
    ]
  },
  "x-amazon-apigateway-request-validators": {
    "Validate query string parameters and headers": {
      "validateRequestParameters": true,
      "validateRequestBody": false
    }
  }
}